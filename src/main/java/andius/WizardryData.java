package andius;

import andius.objects.Dice;
import andius.objects.Item;
import andius.objects.Monster;
import andius.objects.Reward;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.reflect.TypeToken;
import jakarta.xml.bind.DatatypeConverter;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Objects;
import java.util.Random;
import org.apache.commons.io.EndianUtils;
import org.apache.commons.io.IOUtils;
import static utils.Utils.intValue;

public class WizardryData {

    public static final int DUNGEON_DIM = 20;
    private static final Random RANDOM = new Random();

    private enum CellType {
        NORMAL, STAIRS, PIT, CHUTE, SPINNER, DARK, TELEPORT, DAMAGE, ELEVATOR, ROCK, NOSPELL, MESSAGE, ENCOUNTER
    }

    //wizardry 1 proving grounds
    private static final String L1 = "555555555500545500040800500000007400005540914500005500944D00501440064000144040066400004000500300001440550100555546555500000001008100545551555500505550559900705550551500B09A50559A00301050550000605750B5990040555001000050155099590054154010400001005414640005005518540015015514A400150254804200150155149400094495105400458454140400494455040400450055020C0001000100410000000404000005002400000055551500D00055D52500D000956015005400952025007500550054581500150025581600054055D3C400010055D3C4005455000C040050000000740000554091450000550094C50050144006400014404006E40000400050010000144055010055554655550000000100810055555155550050555055950050D550551500907A5055990010105055000060555095990040557001000050155099590054154010400055555D555500000015055900014015069500454015056900850015A050004540150D6500015125045500112115054100125115014100114095004200004000405000000001010000010009004000F57F05007400555509007400155805005500254809405D001500155645000540099645000150D53471000140E534710000D8030000D801000CD809000C0000000CC089A860C021B266D81FB166180E0006003E9200000000000050000000000000000C0000000C0000000A0000000A0000B80F0000A00F0000F80F0000F80F00010000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000AAAAAAAA0000A3AAAA4AAAAAAAAA0900A0AAAAAA0A0000000000000000000A0000000000000000000A7065000000000000080A0000000000000000000A0000000000000000000A0000000000000000000A0000000000000000000A0000000000000000000A00000000000000000010B16BBB8B050000000000000200FFFFFFFF01004D00B7FBB6FB00000000000000000000000000000000000007000000030004000B00120018000400000000000000000000000000000000000C00010008000F000400040004000100000000000000000000000000000000000000040000000100000000000500000003000000000003000000";
    private static final String L2 = "0555455555000055010000005555065405007401005001004049454101000054454101004001005001005405005405001041650105001405140010000010295414000050155514001405541510001041011055005605006515000000005405005555155001005756164001000000005005009D95155415001101500000001102540000000110510410000554521410004508801A1600450450141000050090041000051050000000455102061900455055056500858049096A00455000026500455144411900051040510000410040014000410040055000020000155500111151155000111151054000010040010000005D010000005555065805005401005001004049454101000054454101004001005001005405005405001041650105001405140010000010295414000050155514001405541510001041011055005605006715000000005405005555255001005756164003000000005005009D95155415000555455555004C00140040008400150040000044140144000195140544001102A0864500110114054400010018014400010414004000519480414600115455415900216052825A0011248040590051145150460001045014400010005000500010005001540000004045550044445405540044446401500000005000400000000000000000000003000000030000180081A8180020B2000010B13E0000003E0032923E0606007E0656003E0006003E0002003E400000070000000700000000000000FF030000FF030000000000000000000000000000000000000000000000000000000000000000A0AAAA00000000000000A0AAAA000000000000E0AFAAAB00000000000000A0AAAA00000000000000A0AAAA0000000000000000000000000000200000030000000000000000000000000C000000009000000000000000000000000000000000000D100080000000000000000000700000000000000000006000000000000000000050000000000000000000000040000000000000000000000000000000000000000000000000000000000000000010BBB1BB82B5BBBB00000100610062000300FFFFFFFFFFFF000000000000B5FBB9FBB8FB5F00600000000A00200024000B0029002B002D0008000400000012002F0032008A008A0000000000050005000F000100010001000200010000000400040004000500050007000000000005000000080000000000050000000A000000000005000000";
    private static final String L3 = "15151515150015151515150000001900000019191919190000000000000015151515150015155515150000005001000019199403190000008004000015154109150015159515150000000000000019191919190000000000000015151515150015151515150000000000000019191919190000000000000000000000000043435743430041416A414100414141414100C1C1C1C1C100000000000000434305504300414105554100414145694100C1C15551C100000091500000434341434300414141414100414141414100C1C1C1C1C100000000000000434343434300414141414100414141414100C1C1C1C1C100151515151500000025000000191919191900000000000000151515151500151555151500000050010000191994031900000080040000151542091500151555151500000000000000191919191900000000000000151515151500151515151500000000000000191919191900000000000000151515151500000000000000D0D0D9D0D000505056505000505050505000707070707000000000000000D05001D4D000505041555000505051565000707065547000004014140000D050D0D0D000505050505000505050505000707070707000000000000000D0D0D0D0D00050505050500050505050500070707070700000000000777707007777070077770700777787A8000020B2770017B177100700770837927708070000005000777707007777070077770700777707000000000077770700777707007777070077770700003000400040008000300000000002000000000000000000000000000000000000000000000000000000000000000000000000A000900040009000400000000000000000000000000000000000000000000000000000000000000000000000000000000000900080070000A000300000000000000000000000000000000000000000000000000000000050000000000000000000000000300080001000A00040000000000000000000000000000000000000000000000000000000000000000000000000000000001041C286BB0B000000000200040000000000050003000000FFFFFFFFFFFF0000000000000000000000000F0012000000080004000100040039003B003D0000000000000000000000000010000A000000030028000D000100010001000100000000000000000000000F00000000000A0000000E00000000000A0000001400000000000A000A00";
    private static final String L4 = "505501000000501500000000602500000000206055551500206055510500602500500900501500000800000000500900000000540500000000000100555555150100555565150100605D52000000200002590000200002040000200002000000200002000000205056550500205056551500605D02000000000000000000906A00000000505000000000905080004000505000A45A00906A00145400000000145400000000A45A0000000040560000000040530029002880560090AA9642510050140581510050140514500050140500500050140500500090140500500050F40108400050140500000090AA06000000501500000000602500000000206055551500206055510500602500500900501500000800000000500900000000540500000000000100555555150100555555150100605D52000000200002590000200002040000200002000000200002000000205056550500205056551500609D02000000505501000000000000000000A41A00000000141400000000141420001000141400A91600A41A00051500000000051700000000AA16000000009015000000005014000A000AA05500A4AA55501400144541601400144501051400144501001400144501001400148501001400147D00021000144501000000A4AA01000000000000007C000000440000004400000044C083A87C0022B2000012B100C00300000031920000000003005100FC7D000004710000042100000401000004010000040100008400000004010000FC01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000A80900000700003200010000000000BC660600000000000000006656000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000E000000D000000000000000000000000000000000000000000000010BBBB8CB8BBBBB100000300FFFF0200FFFFFFFFFFFF00000000FFFF6400FFFF64005F0005006300000008003F00430049004B000000040009004D00500058006B00850000008A0000000100010009000100010064000100040001000500010002000500000005001400000000000A0000001900000000000A0000001E00000000000A000100";
    private static final String L5 = "555555550400075045140400963000410400895041100400540100410400559255110400546195410400B443407004000430011004007455024014005457D5110000400501600A00180041500500000014002000550644000000120013A02A00100001901500504955411400A08A99010400541500100400410468284100615558145900191D5414410001755414590029571817410009040010590019145117410059551414590059151514410001301014490085500014490045500504500085504055550049900C555500615050545500655005545500E5500014090065150090590005504454410001C0442459000750451404009630004104004950411004005401004108005692551104005461954104007443407004000430011004007455024014005457D5110000400501600900180043600600000014001000550644000000120011A02A00100001501500504555411400A08A9901040054150010040055555555040010011A4A5000581516455600460715455000401D15455600CA15C64550000201004456000645D4455000561505455600564505455000000C04455200211400455200115401015400211450555500122441555500181414555500195401A56A0039140045420059050054560001141175500000301149560000020000C0010200C001000080010200921180A8000022B2C21410B1561C0200161D3092001C0600861F5600BE1E0400BE170400BE110000BC1B0000BCDE0700BC1F00003C000200801F0000801F0200010000000000000000000000000000006000000000000000000060000000000000000000600000000000000000006000000000003000666666000000000000000000600000000000000000006000000000000000020060000000000000000000600000000500004044446400000000000040404404000000000000404404040000000000004004000400000000000040444004000000000000404044040000000000004044440400000000000000000000000000000000000000000000000000000000000000000010418A25000000000000040006000000000000000000000000000000000000000000000000000000000007000800000000000900000008000000000000000000000000000000000000001100080000000000040000000500000000000000000000000000000000001E000A0001000A0023001E000A0002000A0023001E000A0003000A001E00";
    private static final String L6 = "5555555575005415505520000440561500009819A82A20000005000020001808981900001407545520004A35509502005055541520005055541510005A15008412005454000420001010141500005014141520005014001A000010502610200054155055200057D55F55030003C00C002300D557545F750001802000040025912000550015115555550045404544050045514544550085550500550045C00500050011000560040021000080540091008566F40005004561550005054565050095650500050005004555550095054561550005856062050001802000540085491526550045C5351507000000000000005415505520000440561500009819A82A20000005000020001808981900001407545520004A35509502005055541520005055541510005A15008412005454000420001010141500005014141520005014001A000010502610200054155055200055555755010003C00C002300D557545F65005555555575000020080041004924084055004544555555001150115141005154115155006155014055001170014041000440011841000800002055002440A1197D0001405158550041415159410065590140410001405155550065415158550041219858410000200800550061528549550051714DC5410000000000000080030000BE0304003E7E0400067E0000067E84A8200024B2000010B1038001000380359207A6010000065400002600004400000000760400044604008043000080030400E7CE0500E7CE01000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000300000000000000000002050000000000000000030000000000000000000000000000004000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000001021840B00000000000005000700000000000000FFFF0000000000000000000000000000000000000000080013000800000009009F00000000000000000000000000000000000000000008000000060000000400010000000000000000000000000000000000000028000A0001000A00230028000A0002000A00230028000A0003000A002300";
    private static final String L7 = "54455551150001005500400060009E0007009000A60000005000AA03050000801503000055CD1573550055CC55735500560C82409500580E82802500680100402900580282B0250056018230950055CD5533550055CD5473550000C05402000050C0AA0006003000AA0000005000960005000100550040000450021640000150A9150000D1515515110051515515210001509910000001F0C03F000000000000000001FF00BC0000A5428A566A00955600545A00955600545A00A5568A066A0001F800FC030000000000000001F00F3C00000110981500009152551515005151651535000150A915000004500216400002005500400060009E0005006000A60000005000AA03050000801503000055CD1573550055CC55735500560C82409500580E82802500680100402900580282B0250056018230950055CD5533550055CD5473550000C05402000050C0AA0006003000AA00000050009600050001005500400054455551150001948005100000546A054000D45455454400645455454400005426044000003CF00F4000000000000000C03F002F4000A990A2955A00A51500955600A51500955600A995A2815A00003E00FF400000000000000000FC030F4000000466054000A45455454500545459454D0000546A054000019480053000811F0800801000008C1003008C100300800080A8801720B2000010B12FC00F00014938922140080021405800210908003F400F0000000000801E0000001000008C1003008C10030080100000811F08000000000000000000001000000000D0000000000000000000E00000008800000000000C000000880000000000000B0000000000000060000000000000000000000000500000000000000000000000007000000000093000000000000000000000000000000A0000000000000000000000000002000000000000000000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001061646A25B8BB0C000006000800070000000700000007000000000000000000000000000400000000000800000000000000060000000C00000008000900A600A700A80000000000000008000000130000000D0000001300000007000400010001000100510000002D000A0001000A0023002D000A0002000A0023002D000A0003000A002300";
    private static final String L8 = "5555555555000054551500000051550500004044550100000041410400000000811400000040440000000041510100004556555555004156555555000541010055000100014055000000001500000001550400004044550100000051550500000054551500005555555555000000000000000000000000001000004000001004004000001011005000005044005800005001844900005001414500005041144400005006004000005008000000005006004000005441044000005041018000005041014900005044005800001011005000001004008000001000004000000000000000000000000000000000000000000054551500000051550500004044550100000041410400000000811400000040440000000041510100004556555555004156555555000541010055000100014055000000001500000001550400004044550100000051550500000054551500005555555555000000000000000000000000005554555555000400001000000401001000004404001400001411001600005400611200005440501100005410051100009C0100100000340200000000940100100000551001100000545000200000545040120000141100160000440400140000040100100000040000100000000000000000000000000000000000000000000000000000000000000000801F0000001E80A8001F20B2811D10B1100000001800309210000000800150008000000080100000801F0000000000000000000000000000000000000000000000000000110000000000001011111100000000000010111111000000000000101111110000000000001011111100000000000010111111000000000000101111160000000000001011111100000000000010111100000000000000000000000000000000000000008300000000000000000088005000000000708888880000000000008088888800000000000080888888000000000000808888880000000000008088888800000000000080888844444444444444444444444444444444444444444444444444444444444440856966050000000000000000000000000008000800080000000000000000000000000000000000000000000000090000001200050013000000000000000000000000000000000000000000000004000000030005000E000000000000000000000000000000000032000A0001000A00230032000A0002000A002300320003000A000A002300";
    private static final String L9 = "000000000000000000000000541555551500504900000000405555560900000050570400010050145800050000004000190050245000014051554000190000000000094052554000050040154000048001001000100004001500008015400100441500000100000000000000541501001500000000000000004001000000004001000000849045884800141088444400540000055400540010004500580000458500440000454500480010001500444004005400494004005400504014001500444054405500444054404500444068404A0054400400440084040400410044080400410000400100000000400100000000000000000050155555150050490000000040555556090000005055040001005014580005000000400019005024500001405155400019000000000009405255400005004015400004800100100010000400150000801540010044150000010000000000000054150100150000000000000000000000000000500000000000500000000021641122120005042211110015004001150015000440110016004051210011004051110012000440050011100100150012100100550014100540050011101550150011101550110011101A901200151001001100210101401000110201401000005000000000005000000000800000008000000080FE070000FE0700000084A8000026B2006010B1006000000600309286010000800150008001000080010000800100008001060080010600F8010700F8010700800000008000000033333303333333333333333333033333333333330300000000000000003003000000000000000030033033333333303303300330333333000000033000303333333300000300003033333333000003000032333333000000030000303303303333330300013033033033333303000030330330000000030003303303303033030330033033033030330303300330330300303303003003303303303333330330030000003033333300300300000030333333003033333303333333333333333333033333333333338063000000000000000000000A0001000000000000000000000000000000000000000000000000000000090000000500000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000037000A0001000A00230037000A0002000A00230037000A0003000A002300";
    private static final String L10 = "55001555550014500054000001400010640000001500150000050000450040151504000000001415000054500000100010400101540000405114500000500004040000000000050000055001500040055441000000005510140050010004040054500501050054404540150000411559000001500501000001014101040045114205050040514155410040510055000041400055510001004141550001000500550005110400050054510005050055111448150055011554210055011554100054100550000014000114010014000445450004040451510000152055400004565014000004111001010005010004010014500054000001400010640000001500150000050000450040151504000000001415000054500000100010400101540000405114500000500004040000000000050000055001500040055441000000005510140050010004040054500501050054404540150000411559000001500501000055001555550040405000410051845041410050545055100050144015000010104055540000405050550000400140550041040140410055144041010055040552450055400555480055400515440015440114000005400045000005004151110001014154140040054815100081151405000041044440000041000041400000070E0000070E000007000000000000000080A8000020B2000010B10000000000003092001C0C00001C5C00001C0C000000000000000000000E0000000E0000000C00000E0000000EE000000EE000000800FFFF00F100000020FC0FFF0000F0F0FF0070FF0FFFF007F0F0F000F0FF0FFFF0FFFFF0F9FFFFFF0F00F0FFFFF0F0000FFFFFFFFF00F000F0000FFFFFFFFFF0FFFFFF000F0F00FF00F0FFFFFF00000F0FFFF0FFFFF7FFF0FF0F0FFF00F00000F0F000070FFFFFF040F0F000300F0FFFFFF000F0F0FF070F0F00FFF0FFFFF0FFFF0FFFFFFF0000F000FFFF0FFFFFFF0F60F00F0FF00F00F0FF0F00000FFFF0FFFFF00000000F0F00F00FB0FAF0FFF70FFFFFFF0F00FF0000FF0700FFFF0C00FFFFFFFF5F00FFFF60666666BBCB069000000A000A000A000A000A000A000A00FFFFFFFFFFFFFFFF000000000000000000000E00130011000A000900050000008C0099009D00000000000000000000000000020004000E00050012000C0000000100010001006000000000000000000046000A0001000A0023004A000A0001000A00230056000000000009000000";

    //wizardry 3 legacy of lylgamon levels
    private static final String W3L1 = "4555685529003000140014000E005555590001000456690000009680910000002252910000001858910000A066569100555555555500A69114001400040268692900509064551900190580AA0200495280AA0200405220820800251400820000005080690200141AA0410A00661980590200000084AA12006100650064003100010000000C0021099800010025856800010061552900010055956900010095852900015001846800412801000000051165006400211525986000216451121600416551551500910051551500112551551500458591551900459551891500052851891500A144510115005144655565003000140014000E005555590001000456690000009680910000002252910000001858910000A066569100555555555500A69114001400040268692900509064551900190580AA0200495280AA0200405220820800251400820000005080690200141AA0410A00661980590200000084AA12004555685529001840190059000C4000004000034048022600004049215A00004058554A00004055655A00004065614A00005400215A00104A000040004144190059004845092658000859948445005059545545002440545545004449545545835161645546B0516554624500014A5462450028515440455D1451595559000006060000000000000C0000006E0C0000C4010000C40D0000E2010000600C0000F00000CFF60600DF620400DFF80100D8F8010003F38CA9C3F3ACB1E6F31CB166FB0D0000F871847B08C1847B0AC5840D000000C0000000000C000300200000000070003000002000000000006000002012000000000000020012110000000000002120112200000000000021202100000000000000111211450000000000000000000000008888000000000000C0008888000C000000000000000000000000000000C000000C00000000000000CCCC0000000000008800C00C0088000000008800C00C0088000000008800C00C0088000000008800B00B0088000000000000B00B0000000000000000E000000000000000000090FA000090BB11BB1CC11C6B000000000500010004000500FFFFFFFFFFFF02000300FFFFFFFF0000FFFF000000000000020000000100000004000500FFFF00000200FFFFFFFF0000090000000000000005000D000700120001000100000013000200010003000000010000000200000000000500FFFF0700000000000500FFFF0700000000000500FFFF";
    private static final String W3L2 = "5555555555DD5455454104B95015556021FF59550554200D0011614216D881544920550040094109140219927400150582249210D1001005584202C675554111580A0401A65414FF16040231830D0410802190C625306010340A55F07058002F5481CC1542CA14C5515501A3901553000012C030540090020D008214492F2100A194540CC1404085440C4122521656B2414414550000454958440D2F4954115441A84585955541004161111519CFD148455434A2416845C1142F59515505460049455558153A5165155545C63155150845CD016455C555100D5111081506894115031106554C040210001555000061005455454104A650155560217359550554205400116142167281544920550180054109140119A1740015CC82149210D1801005584202047555411158F70401A65414A61904023183730410402190A625105010346B55F07054006F5481C815426314C551550120901553000066C0305400900255555555551A0380208552610840281555C630105021510090889485551F1011451540A65112165143F4125604555000916165555000505844454601345211154D00305A513045A65654558151A65251155645015455455551014C55054251830055555155B0435404434500A250C540440015138100445D4515004058CC01F827A203FB27A37FF827A3FFDB97C6FF53C000FF1B2F00FF030FCDFF0FBF02FF0F4F00FF9F1FB6078F3F00070919B60758A15B475089A9431CAFB1C0FC1FB1CEFC0F00FEFD7F84FEF1CF84FEFFCF840000000000000000006000000000000000000000E0000000000000000000200000000000000000000000000000AA0000007000000000000A000000000000000000AA0A0000005000000000B00A00000000000000000C0A00000000000000000000000000AA0A0080090000000000000A00000000000000F0000000000000000000D0000000000000000000000000000000000000A00A000000A000000000A00A0000000000000000A3AA000000A000000000AAAA000000A00A000400AAAA010000A0AAAA0000AA00106CBBB116B5B6CB00000100FFFF0200FFFF12FC040050000200040000001C000200FFFFFFFFFFFF00000D00FFFF12006B001600020047000C000D0000001A00090010001100FFFF000013003C000300010004000A000A0009000D0001000A000B00010001004C000C00000000000A00FFFF1600000000000500FFFF0C00140001000A003200";
    private static final String W3L3 = "0555000151DD0040184106B95555555565FF02000000500D5100000000D85001000000005505000040025415000010055855000040005955010090C650550500100A5155150040FF54555500100D5555550100C651555505400A50555515402F5155555505CA5455555511A3595555556512100154000102514444501A2F15110111210C10555555150C1155555515B215545555550011505555552F1140555515A81500555515001000545515CF1400505555A214004055552F11000055150010000054553A1000005055C61400004015CD1400000055101100000050061100000011062114A04421005149455414000040184106A66555565565730200000050540100000000720000000000010900000040010400000010CC0800000040800500000090040000000020F70100000040A60400000010730500000000A601000000406B00000000406F01000000056304000000112009000000656610015400010205550001511A1411119446614944404448C608000000000004000000401F0500000050A60400000050F40400000040000500000040000800000000010500000010000500000010A60400000040A60400000010010400000010010500000000830500000010B004000000540004000040440008062851485D5452111545CC03062DA203002CA3000020A3000090C60000C00000002000000000CD0200B0020000400001001CB601003800000010B60000A05B000080A90000A0B1000010B100000000000070840304CC841306CC844A000000000000000060000000000000000000000021000000000000000000030000000000000000000000000000000000000000000000000000006000000000000000000000B000005000000000000000000000000000000600000000000000000000000000000000000000009000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000DC000000000000000000EF00000000000000000000800800006000000000000010BBB166BB6BBB9B00000100FFFFFFFF05005EAC030000002B00F0ADCA000300FFFFFFFFFFFF000000000E000E000F0000002300030000002900260008000000430044004500000000001300010001000B000400030000000B0004000E00010001000100010000000C00000000000A00FFFF1B00000000000500FFFF0C00140001000A003200";
    private static final String W3L4 = "5555555155DD5550502057B9553F4B2114FF30505025240D7F54951514D86540940657001554551557028514551514051004460400001410112614C6150C5409570A1914411057FF94048807140D1215142024C610119205140A95155514572F5555055255CA64A2505055A301004040811264A21010A60210C48C64002F09761556010C5515D550690C15C5846A65B241048161010004158052002F410100C001A89545416049008595914545CF8145194401A244955154002F11911546010045455151653A2988155169C64561814901CD0000600400101196910580062A41801468062AC1409651001196911521005550502057A6553F4B2114733050502524547F54951514726540940657011554551557018514551514CC100446040080141011261404150C540957F71914411057A69404880714731215142024A610119207146B95155514576F55550552556364A25050552001004040816664A21010A60255555551551A083123190061825D855540C6554535545A004531915A591F1041605840A64205902400F45000007040006551105852006165645151016051065140005265141500A64464855140A65151545459010A6245545A015158605240830000180100B08465640160004A1020059A004A309065945D8465644548CCE05F20A2EF5F20A3EF4726A3EF7F96C60778C00000782000070000CD677FB602677F4600677F10B6667F3000437F10B66F7FA65B7F7F86A97F6FA0B1000010B1FF030800FFC77F84FFCFCF84FFCFCF84444404004004404044440000040040004040000000030400004044400000000004000000004090000040444444040040000004004444440400404444000044444444444400005000044000000040B00000004440000000400000000044440000004000000401844400000040444400004440070000400000000004400000CD40A00000000040000000400000000000400000004000004444444444004044444400000000000040444404E0000EE0E0004000E000E0F000000060400000EE0000E00E0E0F400200001061153B6BBCB36B0000020006000400000001005900040004000400FFFF00000200FFFF010004000000130000000600010007005100070020000600FFFF4A000B001D0022000F000000000005000100010007000A00010003000E004B000F0002000100090011002000000000000A00FFFF2A00000000000500FFFF2000140001000A003200";
    private static final String W3L5 = "00800A2600DD0080221600B900802A2600FF0080152A000D0080192200D80040552A00000040551100020000501100050000550900000040AA0400C600006905000A5515204055FF0641454A440D5401455640C6A4191000510A00145529552FA401000055CA54644C6949A346061180801255554255550200401565002F00405569000C00406969000C0040A95500B200401A55000000400254002F0040228200A80040225600000040045400CF0040544100A200409154002F4518511480009A590585553A1A98514492C64A44514449CD4A04454480101A42908440061A20955450060525556411000040166900000080222A00A600802A2600730080152A00540040192200720040552A00010080551100010000501100CC0000550900800040AA0400040000590500F75515204055A60641464944735401465540A6A4191000516B00145529556FA4010000556354644C69492047061180806655554255550200800A26001A0050451900610050551A00C600505A1A000000506A15001F0050451500A60090001500F40090882000000090881500000010011500010010551000000050141500A61146140560A666564161950106661491A40112512851928312411111A0B086102421900006482515940041491559445D0090451A00CCFFF32FA2FFF72FA3FFF72FA3FFD79FC6FFD3CF007FC02F007F830FCD7F93BF027FA04F007F8C1FB67FBB3F001E3F18B61E8EA85B027F88A97E7BA9B11E7818B102780800C2FA7B84F0FBC384FFF3CF8400050008600010800000000000086606008000000700070866060080000700070008000000800000000000F80E000080000700000A8800002080000050000008000000890507000000080000008000007000000800000080000700007008000000800000888888080000008088880B00000000000000000000000000000D0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000C00000000000000000088888808400000808888106BBB2CA516B1BB000006006A000000FFFF3100FFFF05000000000005000300010000003B00090000000000650000002C002F00FFFF050000000000070001000600490032003C0000000E000A00000001000B00480001000000000005000000070010000B0002002000000000000A00FFFF2F00000000000500FFFF2000140001000A003200";
    private static final String W3L6 = "0510055455DD1414110500B90005505000FF44100150540D4515144001D8150510045500460089419002003554905105A601050454005005501008C605101504140A5015510104FF46000428400D0050001090C656235101400A05650401022F0910050402CA4041140054A354554105001200055405080241050041042F45411511050C11511104040C0444411545B218611515140005415144852F114144110CA85110011504005151511010CF2151054544A221110051442F11461154100051141554103A5154141440C64550441000CD140141150A105054041100061511104514064500114014005351416404001414110500A60005505000734410015054544515144001721506100455014600894150010035549051CCA601050454809005501008040510150414F75015510104A64600042840730050001090A656235101406B05650401026F09100504026340411400542054554105006600055405040205100554551A5001401041615150454441C644540401410001515045111F4654450505A64150145151F44410510443001444400541005454140444014854411151008808401451A64451041544A61445051544012415050550011114110440834540508502B014154104000045044411490011400410455D54541019C1CC000020A2000020A3000020A3000090C67200C00070042E00730E0ECD03C0BF0207C043003F8011B63F8031001F8013B61FC0A35B5FC08FA940C0AFB103C01FB100C00F0000807F840080CF8400A0CF846666666666666666767766666666666666667677666666666666666676776666666666666666666606664F6066666666666661660060666066660680006600600600666606000066666666666699090000506666666666999900000033666666669609000000336066666696090000006B6666776796990000046066667767909900000E60606677679999096266666066666699999909666666666666999099666666666666669999996666666666666696D900666666666666669649006666666666660696A90010C1BB9556BBB0BB000004000500FFFF0200000000000000010000005F006400000017B10DB1460000000E000D00FFFF3F000D0001000000000000005A00600000004600460046000000130000004D000D000D0001000000000000000A000A0000000400040004003400000000000A00FFFF3E00000000000A00FFFF3E00000000000A00FFFF";

    //wizardy 2 knight of diamonds levels
    private static final String W2L1 = "5555555555DD5455455515B95855856A00FF14014005000D5441055114D85405005114005001A10500028040AA0624056042100400005455205415C654552054150A4040104401FF0041AA56250D0001655500C664240155000A20110110002F2014014400CA1014415905A304010174151254554555150201000000002FA5AA6A00450C190051154A0C0516521045B205505036400005405010452F159455214AA89556021845000550061945CF0180A22800A205100619462F555002184C0055545509543A5550510055C6550050015DCD5541591555105501503454060541540440064500500140000100000000005455455515A65855856A00731401400500545441055114725405005114015001A10500018040AA0624CC6042100400805455205415045455205415F74040104401A60041AA5625730001655500A664240155006B20110110006F20140144006310144159052004010174156654554555150255555555551A000000004061A9AA1A4051C606405485520081851444511F0114540D60A60110144451F4056555885200A5950046510001944146510100A0280A40000184418651A61594000653A61555550255011554144055011500544057835550564555B05500140D550041101501500011005400505D0000000040CC000020A2DE0326A302FB26A310C396C68003C00080C326009CCF06CD9CFFB60280FF4600803F10B6003F3700803F16B6001FA05B000080A90400A0B1040110B104200000000070840000C0840000C084050000000000000000000000D00000000000000000666666000000000000606660660000000000006066660600000C0000006066660600000000000060006006020000000000600060360000100000006066663600001000000000000000000B0000000060666600000010000000606A6630000010000000606066604440000000006068666066000000000060606666660000000000606966666000000000006067666666000000000060666666660000000000606666666600000000000000000000000000000060661615C6BB2200000001000100010001000000000002000100FFFFFFFF76004600280000000000000007000A000D000A00000000000A0002000100000034000A000A0000000000000009000C0009000600000000000B000C004D0001000C0002000200000000000000000000000A0000000000000000000F0000000A00000000000F000000";
    private static final String W2L2 = "5555555555000410545545000060004414005621551111004006441411000401504515820002840500A95546555002000481140200000801501900855905204058A90401000518FE049150606100555514010182062455541800A80A161110839A29445515A05A2900100185A80A681001000624140011AA05000100001811504524108111901111650185540104612B4550154164025155014144176150511155004150024155019556654455C64150554414A14150150429C6A569151215CD412005411450896201455026A55A01010400514541104500A146511440025145014014C5A55A6505418189A2014400CD0410545545500060004418815622551111004006441411000401504515B80002840500005586555002000441140200B8080150190000590520405400040100051400049150606100555514010100062455541400A80A151110065A29445555A99A29001001BCA80A6410010006241400110055555555555001400000404704541109444E046444445920215500415841115445105952545540105187185494445500109440505500A55519515500105415114500105405414500695A85444500104841104500A29840115400A956400041835451104451B0585114055000545100104500A9565951505DA2680011404EFF004087FF2040467F0076FE3F0006443F0056463F0030883F38404FBF7000A63F6000483F7C40493FFC22883FFC4047FF7040527F6080A97F00A0B17F0010B1670000007F0070847F00C0847F00C084000000002222222222220000000A2222022202220000000B222222220225000000092222222280240000000022222222022600000000220222222222000000002202002222220000000000000020222200000D00000300202222000000000000002022220000000000000000022200000000000100002222000000000000002022220000000000000220222200000000222222222222000000002222222222C2007000002222222222220000000022222222222200000000F22E222C222200000000222222222222106566B6BBC12BBB00000100000002000200020002000300FFFF29000300FFFFFFFF0A008600FFFF00000200000010001300040000000400070010000000010047000A00820087000000100000000300130010000000090001000A0000004B00010001000B0001000000000000000F0000000A00000000000F0000001400000000000F000000";
    private static final String W2L3 = "1124111514DD5111849141B90045504055FF45554155010D0100000050D81414142814000400001444020114142840052400100018004981614141C644004100850A4141494281FF24000400400D0128141450C604140008000A01281414502F2400080004CA4155455511A311445054551241114041040200145100012F14004514100C40001000100C4000540044B245005400040041440054042F5444005418A84100840054005400540014CF0144094450A214448045502F41005400540054004800143A4154005454C65454006414CD4100440004105400540054060110048200061001141000001151554040005111849141A60045504055734555415501540100000050721414142814010400001444010114142840CC2400100018804981614141044400410085F74141494281A62400040040730128141450A604140008006B01281414506F24000800046341554555112011445054556641114041040211241115141A0045144000610540110504C610000400040010001500111F1100150041A61011001541F41511001506001000210055001500150005010051021154000511601114A61000150055A61500120005011015001555011515002905831000110041B015001500150000048120400044000504005D4454151050CC000020A2000020A3000020A3000090C60000C00000602000006000CD0006B00202064000801F18B6801F3000000618B60006A05B606080A96060A0B1000010B100020000000070840000C0844000C08401000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009000000000000800800000000000000008008000000000000000000000000000000000000000000050000000000000000030000000000000000000040000000000000000060000000000000000000000000000000000000000000000200000000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001061B6C2B9000000000002000400030003000A000A00FFFF0000FFFF000000000000000000000000000006000C0000000D000B001900010000004F0000000000000000000000000000000100070000000D00080005004900000001000000000000000000000000000A00000000000F0000001400000000000F0000001E00000000000F000000";
    private static final String W2L4 = "5140550554000141001044000100440140004404114410000400000500001011040541825000405101A90510504105004044405101000401411010850012004401A91012040115FE4045010054004140141400820000010050000411441004830140050001A01044114154850400414100004110554505AA15414410041810044540508115041144100141114410412B5511440141020544501004171545100400000415004110014440415414C65045040544A15015045140C60040105401CD4110145405500551511005260551541015001104004101001444104104024510440401C55110014000811541001010CD0141001044500100440140814404114410000400000500001011040541B85000405101000510504105004044405101B80401411010000012004401001012040115004045010054004140141400000000010050000411441004060140050001A91044114154BC04004141000041105545050051405505545045101104414704411110144E0541041144205004114450415504514050520111140441874511040140004105001004001150101505005411410111005405411410001010045500001004055541004154144441004114154445830401405040B005114410010011041141400014440010405D45100004444E0006408700064846021870FE083800440A085046000030880200404F000000A60080014810804149100020880000404780014052400380A94002A8B100001AB180010A00008470840005C0840000C2840111001001101100101100110100011011010001011101001100100100111101110A1001001100100101110010011111001001001001000100110100011110010B110100C0001011100000009210110010010010001001011000B001031001BA0100100100010411010011101101000000101100101000000010110010001010101101001110000100111011010A111001010011100011001011111100100000100010517811A0100100100100116110010011110001B011000000101111011100101111110000119011BCBBBB270B000000000003000500FFFFFFFFFFFFFFFFFFFFFFFF00000500FFFF000000000000000000000E001200010031002D002F00300048000A000A005000000000000000000000000D0001004A0003000100010001000100040002000100000000000000430000000000060000001E00000000000F0000002800000000000F000000";
    private static final String W2L5 = "545541551500545641951500104041010400305400150400541400141D0094A5825A16820050650500A91041574104004001414001005C05575035855501184055A95C05D55035FE4001414001001041D541088200505905000094A5825A16837414001415A0105400150C851040410104005456419515AA0000100000180505DC404181554754445D0105095581412B0944554580024505444045174519009045005558009454011558C59D50C600606C1400A10050642400C615D84D9550CD555800945450451900904526450544404500094455458000050955814102D545544457C50505DC4041810000100000CD545641951550104041010481305400150400541400141D0094A5825A16B80050550500001041554104004001414001B85C05575035005501184055005C05D550350040014140010010415541080000505505000094A5825A16067414001415A9105400150CBC10404101040054564195150054554155155000000400004741013750504ED5111551572041425560504102515511605251011150518751060064510015160025550005567125540000141B0500000014190500000556532554001516002555005106006451005101115051830251551160B0414255605000751115D1550041013750505D00000400004E00004087E0794046E47972FE0009004460695046168036881680464F060006A61E89074800044049000620881E89474706004652168086A91680A6B1606910B100090000E4797284E079C0840000C08466666666666666666666060007006006007000610608070060060070006006000700600600700060767707006006007077670600000060060000006006000066666666000060060B00666666660000600600006660A666000060666666660662666666666666666636646666666606000066650666000060060000666666660000600600006666666600006006000000600600000060767707006006007077670600070060060070006006090700600600700060060007006006007000606666666666666666666610C6B15533330000000004000500FFFF060075000000000005000600060006000000000000000000000004000800010000002A00010000001100010010000F0000000000000000000000090009004C0000000B00010000001100050007000C0000000000000000001E00000000000F0000002800000000000F0000003200000000000A000000";
    private static final String W2L6 = "5515400154005205555505005F41405501005480005009004082400500000050555101824002005901A95056555005000054455615005051050004855600100104A90050595505FE000000554C00005400403682405C55C000001610000014830000005505A05614547551850055577564000055151491AA394000000018A1568100108105144100140105954210102B451481201002450400941A17050500211000150C401300011504500140C60510700174A10111100440C60101010254CD0101010105500105024145264114014144000544014148000544016B50020101051014C501024C44A5810101400494CD5205555505505F41405501815480005009004082400500000050555101B84002005901005056555005000054455615B8505105000400560010010400005059550500000000554C00005400403600405C55C000001610000014060000005505A956145475A1BC0055577564000055151491005515400154500E1000004047A8552000444E01451000452041A510044441114510084452110100A546874101400844000503D004400005015400500001045C005D004004040150004040800055004040404041004081405051001045401051830151401052B00151C01A5400404001044500800023526A5D40001001654E0000408700074046000770FE80C7034418C7534618C0338800F0434F1C3800A61CF00748C0F34749CFE327880F0F46470F0F4E520F8F87A9278FA7B1608F17B1608F07000F0176840F7ECC840F18CC84C20000101111111111B1CC561410000000000011000010000010111101111011100000B01100001110011000000000000011100110111111013E03111011101111B1000000111000000000000011111110001011B110000000101011110000B00000001000001100001101000010000011110000000080100000111100001111C0000000010000001191000000100111000011710700101101100000110B0000101101100000A0101100000011111011B100B000000000000000071000330000111111711711013B50C1B64BBB6B050B000000000500FFFF0100FFFF70000000FFFFFFFFFFFF06000000000000000000000000000A000100090071005D000000570059005B0000000100000074000000000000000A002F00090001000A000000010001000100000001000000040000002800000000000F0000003200000000000A0000003C000000000007000000";

    private static final String[] PMO_LEVEL_DATA = new String[]{L1, L2, L3, L4, L5, L6, L7, L8, L9, L10};
    public static final MazeLevel[] PMO_LEVELS = new MazeLevel[PMO_LEVEL_DATA.length];

    private static final String[] KOD_LEVEL_DATA = new String[]{W2L1, W2L2, W2L3, W2L4, W2L5, W2L6};
    public static final MazeLevel[] KOD_LEVELS = new MazeLevel[KOD_LEVEL_DATA.length];

    private static final String[] LEG_LEVEL_DATA = new String[]{W3L1, W3L2, W3L3, W3L4, W3L5, W3L6};
    public static final MazeLevel[] LEG_LEVELS = new MazeLevel[LEG_LEVEL_DATA.length];

    public static java.util.List<Item> PMO_ITEMS, KOD_ITEMS, LEG_ITEMS;
    public static final java.util.Map<String, Item> PMO_ITEMS_MAP = new HashMap<>();
    public static final java.util.Map<String, Item> KOD_ITEMS_MAP = new HashMap<>();
    public static final java.util.Map<String, Item> LEG_ITEMS_MAP = new HashMap<>();

    public static java.util.List<Monster> PMO_MONSTERS, KOD_MONSTERS, LEG_MONSTERS;
    public static final java.util.Map<String, Monster> PMO_MONSTER_MAP = new HashMap<>();
    public static final java.util.Map<String, Monster> KOD_MONSTER_MAP = new HashMap<>();
    public static final java.util.Map<String, Monster> LEG_MONSTER_MAP = new HashMap<>();

    public static java.util.List<Reward> PMO_REWARDS, KOD_REWARDS, LEG_REWARDS;
    public static java.util.List<Message> PMO_MESSAGES, KOD_MESSAGES, LEG_MESSAGES;

    static {
        try {
            String j1 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/pmo-items.json"));
            String j2 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/pmo-monsters.json"));
            String j3 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/pmo-rewards.json"));
            String j4 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/pmo-messages.json"));

            String j5 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/kod-items.json"));
            String j6 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/kod-monsters.json"));
            String j7 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/kod-rewards.json"));
            String j8 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/kod-messages.json"));

            String j9 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/leg-items.json"));
            String j10 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/leg-monsters.json"));
            String j11 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/leg-rewards.json"));
            String j12 = IOUtils.toString(WizardryData.class.getResourceAsStream("/assets/json/leg-messages.json"));

            GsonBuilder builder = new GsonBuilder();
            Gson gson = builder.create();

            PMO_ITEMS = gson.fromJson(j1, new TypeToken<List<Item>>() {
            }.getType());
            KOD_ITEMS = gson.fromJson(j5, new TypeToken<List<Item>>() {
            }.getType());
            LEG_ITEMS = gson.fromJson(j9, new TypeToken<List<Item>>() {
            }.getType());

            PMO_MONSTERS = gson.fromJson(j2, new TypeToken<List<Monster>>() {
            }.getType());
            KOD_MONSTERS = gson.fromJson(j6, new TypeToken<List<Monster>>() {
            }.getType());
            LEG_MONSTERS = gson.fromJson(j10, new TypeToken<List<Monster>>() {
            }.getType());

            PMO_REWARDS = gson.fromJson(j3, new TypeToken<List<Reward>>() {
            }.getType());
            KOD_REWARDS = gson.fromJson(j7, new TypeToken<List<Reward>>() {
            }.getType());
            LEG_REWARDS = gson.fromJson(j11, new TypeToken<List<Reward>>() {
            }.getType());

            PMO_MESSAGES = gson.fromJson(j4, new TypeToken<List<Message>>() {
            }.getType());
            KOD_MESSAGES = gson.fromJson(j8, new TypeToken<List<Message>>() {
            }.getType());
            LEG_MESSAGES = gson.fromJson(j12, new TypeToken<List<Message>>() {
            }.getType());

            for (Item i : PMO_ITEMS) {
                PMO_ITEMS_MAP.put(i.name, i);
            }

            for (Item i : KOD_ITEMS) {
                KOD_ITEMS_MAP.put(i.name, i);
            }

            for (Item i : LEG_ITEMS) {
                LEG_ITEMS_MAP.put(i.name, i);
            }

            for (Monster m : PMO_MONSTERS) {
                PMO_MONSTER_MAP.put(m.name, m);
            }

            for (Monster m : KOD_MONSTERS) {
                KOD_MONSTER_MAP.put(m.name, m);
            }

            for (Monster m : LEG_MONSTERS) {
                LEG_MONSTER_MAP.put(m.name, m);
            }

            for (int i = 0; i < PMO_LEVEL_DATA.length; i++) {
                PMO_LEVELS[i] = new MazeLevel(1, DatatypeConverter.parseHexBinary(PMO_LEVEL_DATA[i]), i + 1, PMO_MONSTERS, PMO_MESSAGES);
            }

            for (int i = 0; i < KOD_LEVEL_DATA.length; i++) {
                KOD_LEVELS[i] = new MazeLevel(2, DatatypeConverter.parseHexBinary(KOD_LEVEL_DATA[i]), i + 1, KOD_MONSTERS, KOD_MESSAGES);
            }

            for (int i = 0; i < LEG_LEVEL_DATA.length; i++) {
                LEG_LEVELS[i] = new MazeLevel(3, DatatypeConverter.parseHexBinary(LEG_LEVEL_DATA[i]), i + 1, LEG_MONSTERS, LEG_MESSAGES);
            }
        } catch (Throwable t) {
            t.printStackTrace();
        }

    }

    public static enum Scenario {
        PMO(PMO_ITEMS, PMO_MONSTERS, PMO_REWARDS, PMO_MESSAGES, PMO_LEVELS, PMO_MONSTER_MAP, PMO_ITEMS_MAP),
        KOD(KOD_ITEMS, KOD_MONSTERS, KOD_REWARDS, KOD_MESSAGES, KOD_LEVELS, KOD_MONSTER_MAP, KOD_ITEMS_MAP),
        LEG(LEG_ITEMS, LEG_MONSTERS, LEG_REWARDS, LEG_MESSAGES, LEG_LEVELS, LEG_MONSTER_MAP, LEG_ITEMS_MAP);

        private final java.util.List<Item> items;
        private final java.util.List<Monster> monsters;
        private final java.util.List<Reward> rewards;
        private final java.util.List<Message> messages;
        private final MazeLevel[] levels;
        private final java.util.Map<String, Monster> monsterMap;
        private final java.util.Map<String, Item> itemMap;

        private Scenario(List<Item> items, List<Monster> monsters, List<Reward> rewards, List<Message> messages,
                MazeLevel[] levels, Map<String, Monster> monsterMap, Map<String, Item> itemMap) {
            this.items = items;
            this.monsters = monsters;
            this.rewards = rewards;
            this.messages = messages;
            this.levels = levels;
            this.monsterMap = monsterMap;
            this.itemMap = itemMap;
        }

        public List<Item> items() {
            return items;
        }

        public List<Monster> monsters() {
            return monsters;
        }

        public List<Reward> rewards() {
            return rewards;
        }

        public List<Message> messages() {
            return messages;
        }

        public MazeLevel[] levels() {
            return levels;
        }

        public Map<String, Monster> monsterMap() {
            return monsterMap;
        }

        public Map<String, Item> itemMap() {
            return itemMap;
        }

    }

    public static class MazeLevel {

        public int level;
        public int scenario;
        private byte[] buffer;
        public MazeCell[][] cells = new MazeCell[DUNGEON_DIM][DUNGEON_DIM];
        private CellInfo[] cellInfo;
        private byte[][] cellInfoLocations;
        private EncounterOdds[] monsterOdds = new EncounterOdds[3];

        public MazeLevel(int scenario, byte[] buffer, int level, List<Monster> monsters, List<Message> messages) {
            this.level = level;
            this.buffer = buffer;
            this.scenario = scenario;

            this.cellInfoLocations = getCellInfoLocations(buffer, 0 + 0x230);
            this.cellInfo = getCellInfo(buffer, 0 + 0x2F8);
            this.monsterOdds = getMonsterOdds(buffer, 0 + 0x360);

            for (int x = 0; x < DUNGEON_DIM; x++) {
                for (int y = 0; y < DUNGEON_DIM; y++) {

                    cells[x][y] = walls(x, y);

                    if (cells[x][y].monsterLair) {
                        int mid = getRandomMonster();
                        Monster m = monsters.get(mid);
                        if (m == null) {
                            System.out.println("cannot find monster id " + mid);
                        } else {
                            cells[x][y].tempMonsterID = m.monsterId;
                        }
                    }

                    MazeCell cell = cells[x][y];

                    int idx = cellInfoLocations[y][x];
                    CellInfo ci = cellInfo[idx];

                    switch (ci.type) {
                        case NORMAL:
                            break;
                        case STAIRS:
                            cell.stairs = true;
                            cell.addressTo = new MazeAddress(ci.val[0], ci.val[1], ci.val[2]);
                            break;
                        case PIT:
                            cell.pit = true;
                            cell.damage = new Dice(ci.val[0], ci.val[1], ci.val[2]);
                            break;
                        case CHUTE:
                            cell.addressTo = new MazeAddress(ci.val[0], ci.val[1], ci.val[2]);
                            cell.chute = true;
                            break;
                        case SPINNER:
                            cell.spinner = true;
                            break;
                        case DARK:
                            cell.darkness = true;
                            break;
                        case TELEPORT:
                            cell.addressTo = new MazeAddress(ci.val[0], ci.val[1], ci.val[2]);
                            cell.teleport = true;
                            break;
                        case DAMAGE:
                            cell.damage = new Dice(ci.val[0], ci.val[1], ci.val[2]);
                            break;
                        case ELEVATOR:
                            cell.elevator = true;
                            cell.addressTo = new MazeAddress(ci.val[1], x, y);
                            cell.elevatorFrom = ci.val[2];
                            cell.elevatorTo = ci.val[1];
                            break;
                        case ROCK:
                            cell.rock = true;
                            break;
                        case NOSPELL:
                            cell.spellsBlocked = true;
                            break;
                        case ENCOUNTER:
                            cell.monsterID = ci.val[2];
                            break;
                        case MESSAGE:
                            if (ci.isMessage()) {
                                for (Message m : messages) {
                                    if (m.match(ci.val[1])) {
                                        cell.message = m;
                                        break;
                                    }
                                }
                                if (cell.message == null) {
                                    System.out.printf("scenario %d message NOT found %s\n", this.scenario, ci);
                                }
                            }

                            if (ci.val[2] == 2) {
                                cell.itemObtained = ci.val[0];//blue ribbon
                            }
                            if (ci.val[2] == 3) {
                                if (ci.val[0] > 0) {
                                    cell.itemObtained = ci.val[0];//players wades to get item
                                }
                            }
                            if (ci.val[2] == 4) {
                                if (ci.val[0] >= 0) {
                                    cell.monsterID = ci.val[0];
                                } else if (ci.val[0] > -1200) {
                                    cell.itemObtained = ci.val[0] * -1 - 1000;
                                }
                            }
                            if (ci.val[2] == 5 || ci.val[2] == 13) {
                                if (ci.val[0] > 0) {
                                    cell.itemRequired = ci.val[0];
                                }
                            }
                            if (ci.val[2] == 14) {//item required or else teleported
                                cell.itemRequired = ci.val[0];
                                cell.addressTo = new MazeAddress(this.level, ci.val[0] / 100, ci.val[0] % 100);
                                cell.teleport = true;
                            }
                            if (ci.val[2] == 8) {//return to castle
                                cell.addressTo = new MazeAddress(0, 0, 0);
                            }
                            if (ci.val[2] == 10) {
                                for (Message m : messages) {
                                    if (m.match(ci.val[0])) {
                                        cell.riddleAnswer = m.getText();
                                        break;
                                    }
                                }
                                if (cell.riddleAnswer == null) {
                                    System.out.printf("scenario %d riddle answer NOT found %s\n", this.scenario, ci);
                                }
                            }
                            if (ci.val[2] == 11) {
                                for (Message m : messages) {
                                    if (m.match(ci.val[0])) {
                                        cell.feeAmount = Integer.parseInt(m.getText());
                                        break;
                                    }
                                }
                                if (cell.feeAmount <= 0) {
                                    System.out.printf("scenario %d fee NOT found %s\n", this.scenario, ci);
                                }
                            }
                            break;
                    }
                }
            }

            for (int x = 0; x < 20; x++) {
                for (int y = 0; y < 20; y++) {

                }
            }

        }

        private MazeCell walls(int row, int column) {
            MazeAddress address = new MazeAddress(level, row, column);
            MazeCell cell = new MazeCell(address);

            // doors and walls
            int offset = column * 6 + row / 4; // 6 bytes/column

            int value = intValue(buffer[offset]);
            value >>>= (row % 4) * 2;
            cell.westWall = ((value & 1) == 1);
            value >>>= 1;
            cell.westDoor = ((value & 1) == 1);

            value = intValue(buffer[offset + 120]);
            value >>>= (row % 4) * 2;
            cell.southWall = ((value & 1) == 1);
            value >>>= 1;
            cell.southDoor = ((value & 1) == 1);

            value = intValue(buffer[offset + 240]);
            value >>>= (row % 4) * 2;
            cell.eastWall = ((value & 1) == 1);
            value >>>= 1;
            cell.eastDoor = ((value & 1) == 1);

            value = intValue(buffer[offset + 360]);
            value >>>= (row % 4) * 2;
            cell.northWall = ((value & 1) == 1);
            value >>>= 1;
            cell.northDoor = ((value & 1) == 1);

            // monster table
            offset = column * 4 + row / 8;
            value = intValue(buffer[offset + 480]);
            value >>>= row % 8;
            cell.monsterLair = ((value & 1) == 1);

            if (cell.eastWall && cell.eastDoor) {
                cell.hiddenEastDoor = true;
            }
            if (cell.westWall && cell.westDoor) {
                cell.hiddenWestDoor = true;
            }
            if (cell.northWall && cell.northDoor) {
                cell.hiddenNorthDoor = true;
            }
            if (cell.southWall && cell.southDoor) {
                cell.hiddenSouthDoor = true;
            }

            return cell;
        }

        private byte[][] getCellInfoLocations(byte[] buffer, int offset) {
            byte[][] sqrextra = new byte[20][20];
            for (int col = 0; col < 20; col++) {
                for (int row = 0; row < 20; row += 2) {
                    sqrextra[col][row] = (byte) (buffer[offset] & 0x0F);
                    sqrextra[col][row + 1] = (byte) ((buffer[offset] & 0xF0) >>> 4);
                    offset++;
                }
            }
            return sqrextra;
        }

        private CellInfo[] getCellInfo(byte[] buffer, int offset) {
            CellInfo[] info = new CellInfo[16];

            int pos = 0;
            for (int i = 0; i < 8; i++) {
                info[pos] = new CellInfo(pos++, buffer, offset);
                info[pos] = new CellInfo(pos++, buffer, offset);
            }

            return info;
        }

        private EncounterOdds[] getMonsterOdds(byte[] buffer, int offset) {
            EncounterOdds[] enemyCalc = new EncounterOdds[3];

            for (int i = 0; i < 3; i++) {
                enemyCalc[i] = new EncounterOdds(buffer, offset);
                offset += 10;
            }

            return enemyCalc;
        }

        private int getRandomMonster() {
            int encounterType = 0;
            while (RANDOM.nextInt(4) == 2 && encounterType < 2) {
                ++encounterType;
            }

            return monsterOdds[encounterType].getRandomMonster();
        }
    }

    public static class MazeAddress {

        public final int level;
        public final int row;
        public final int column;

        public MazeAddress(int level, int row, int column) {
            this.level = level;
            this.row = row;
            this.column = column;
        }

        @Override
        public int hashCode() {
            int hash = 7;
            hash = 23 * hash + this.level;
            hash = 23 * hash + this.row;
            hash = 23 * hash + this.column;
            return hash;
        }

        @Override
        public boolean equals(Object obj) {
            if (this == obj) {
                return true;
            }
            if (obj == null) {
                return false;
            }
            if (getClass() != obj.getClass()) {
                return false;
            }
            final MazeAddress other = (MazeAddress) obj;
            if (this.level != other.level) {
                return false;
            }
            if (this.row != other.row) {
                return false;
            }
            return this.column == other.column;
        }

        @Override
        public String toString() {
            return level + "/" + row + "/" + column;
        }
    }

    public static class MazeCell {

        boolean northWall;
        boolean southWall;
        boolean eastWall;
        boolean westWall;

        boolean northDoor;
        boolean southDoor;
        boolean eastDoor;
        boolean westDoor;

        boolean hiddenNorthDoor;
        boolean hiddenSouthDoor;
        boolean hiddenEastDoor;
        boolean hiddenWestDoor;

        boolean darkness;
        boolean stairs;
        boolean pit;
        boolean spinner;
        boolean chute;
        boolean elevator;
        boolean rock;
        boolean teleport;
        boolean spellsBlocked;
        public int feeAmount;
        public String riddleAnswer;
        public Dice damage;
        public int messageType;
        public Message message;
        public int itemRequired;
        public int itemObtained;

        public boolean monsterLair;
        public int tempMonsterID = -1;
        public int monsterID = -1;

        MazeAddress address;
        MazeAddress addressTo; // if teleport/stairs/chute
        int elevatorFrom;
        int elevatorTo;

        public MazeCell(MazeAddress address) {
            this.address = address;
        }

        @Override
        public int hashCode() {
            int hash = 7;
            hash = 83 * hash + Objects.hashCode(this.address);
            return hash;
        }

        @Override
        public boolean equals(Object obj) {
            if (this == obj) {
                return true;
            }
            if (obj == null) {
                return false;
            }
            if (getClass() != obj.getClass()) {
                return false;
            }
            final MazeCell other = (MazeCell) obj;
            return Objects.equals(this.address, other.address);
        }

    }

    public static class Message {

        private int id;
        private final List<String> text = new ArrayList<>();

        public boolean match(int messageNum) {
            if (id == messageNum) {
                return true;
            }
            return false;
        }

        public String getText() {
            StringBuilder t = new StringBuilder();
            for (String line : text) {
                t.append(line.startsWith("^") ? line.substring(1) : line);
                t.append("\n");
            }
            t.deleteCharAt(t.length() - 1);
            return t.toString();
        }

    }

    private static class EncounterOdds {

        private final int minEnemy;
        private final int rangeSize;
        private final int extraRangeOdds;
        private final int totExtraRanges;
        private final int extraRangeOffset;

        public EncounterOdds(byte[] buffer, int offset) {
            minEnemy = EndianUtils.readSwappedShort(buffer, offset);
            extraRangeOffset = EndianUtils.readSwappedShort(buffer, offset + 2);
            totExtraRanges = EndianUtils.readSwappedShort(buffer, offset + 4);
            rangeSize = EndianUtils.readSwappedShort(buffer, offset + 6);
            extraRangeOdds = EndianUtils.readSwappedShort(buffer, offset + 8);
        }

        public int getRandomMonster() {
            int rangeNo = 0;
            while (RANDOM.nextInt(100) < extraRangeOdds && rangeNo < totExtraRanges) {
                ++rangeNo;
            }
            return minEnemy + RANDOM.nextInt(rangeSize) + extraRangeOffset * rangeNo;
        }

    }

    private static class CellInfo {

        private final CellType type;
        private final int[] val = new int[3];

        public CellInfo(int index, byte[] buffer, int offset) {
            byte b = buffer[offset + (index) / 2];
            int idx = index % 2 == 0 ? b & 0x0F : (b & 0xF0) >>> 4;
            this.type = CellType.values()[idx];

            val[0] = EndianUtils.readSwappedShort(buffer, offset + 8 + index * 2);
            val[1] = EndianUtils.readSwappedShort(buffer, offset + 40 + index * 2);
            val[2] = EndianUtils.readSwappedShort(buffer, offset + 72 + index * 2);
        }

        public boolean isMessage() {
            return type == CellType.MESSAGE && val[2] >= 0 && val[2] <= 13;
        }

        @Override
        public String toString() {
            return String.format("%-8s  %5d  %4d  %4d", type, val[0], val[1], val[2]);
        }
    }

}
